
{% extends "apply/layout.html" %}

{% block content %}

{% set region = query.region %}
{% set unitsInRegion = data['units'][region] %}
{% set totalUnits = unitsInRegion | sumOfValues  %}
{% set fundingYears = ['2021', '2022', '2023', '2023', '2024', '2025'] %}
{% set quarters = ['Q1', 'Q2', 'Q3', 'Q4'] %}

<div class="govuk-grid-row">

  <div class="govuk-grid-column-two-thirds">
    {{ govukBackLink({
      text: "Back",
      href: "/apply/tasks"
    }) }}

    <h1 class="govuk-heading-l">{{ region }} ({{ totalUnits }} units)</h1>

    <div class="govuk-tabs" >
      <h2 class="govuk-tabs__title">
        Region
      </h2>
      <ul class="govuk-tabs__list">
        <li class="govuk-tabs__list-item">
          <a class="govuk-tabs__tab" href="/apply/total-cost?region={{ region }}">
            Total cost
          </a>
        </li>
        <li class="govuk-tabs__list-item">
          <a class="govuk-tabs__tab" href="/apply/funding?region={{ region }}">
            Funding
          </a>
        </li>
        <li class="govuk-tabs__list-item govuk-tabs__list-item--selected">
          <a class="govuk-tabs__tab" href="/apply/timeline?region={{ region }}">
            Timeline
          </a>
        </li>
      </ul>
      <div class="govuk-tabs__panel">
        <form action="/apply/regions" method="post">
          <div class="govuk-accordion" data-module="govuk-accordion" id="accordion-default">
            {% for year in fundingYears %}
            <div class="govuk-accordion__section ">
              <div class="govuk-accordion__section-header">
                <h2 class="govuk-accordion__section-heading">
                  <span class="govuk-accordion__section-button" id="accordion-default-heading-{{ year }}">
                    In {{ year }}
                  </span>
                </h2>
              </div>
              <div id="accordion-default-content-{{ year }}" class="govuk-accordion__section-content"
                   aria-labelledby="accordion-default-heading-{{ year }}">
                {% for type, amount in unitsInRegion | removeEmpty %}
                <h2 class="govuk-heading-m">{{ type }} ({{ amount }} units)</h2>

                {% for quarter in quarters %}
                  <p class='govuk-body'>{{ quarter }}</p>
                  <div class="govuk-grid-row">
                    <div class="govuk-grid-column-one-half">
                      {{ govukInput({
                        label: {
                          text: "Units started"
                        },
                        id: "timeline-"+year+"-"+quarter+"-units-started",
                        name: "timeline["+region+"]["+year+"]["+quarter+"][Units started]"
                      }) }}
                    </div>
                    <div class="govuk-grid-column-one-half">
                      {{ govukInput({
                        label: {
                          text: "Units completed"
                        },
                        id: "timeline-"+year+"-"+quarter+"-units-completed",
                        name: "timeline["+region+"]["+year+"]["+quarter+"][Units completed]"
                      }) }}
                    </div>
                  </div>
                {% endfor %}
              {% endfor %}
              </div>
            </div>
            {% endfor %}
          </div>

          <input type="hidden" name="currentTab" value="timeline">
          <input type="hidden" name="region" value="{{ query.region }}">

          {{ govukButton({
            text: "Save and continue"
          }) }}
        </form>
      </div>
    </div>
  </div>
</div>

{% endblock %}
